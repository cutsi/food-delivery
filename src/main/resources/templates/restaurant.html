<!DOCTYPE html>
<html lang="en" class="h-100" xmlns:th="https://thymeleaf.org">

<head th:replace="fragments/general-restaurant :: head"></head>
<head>
    <script>document.getElementsByTagName("html")[0].className += " js";</script>
    <link href="../static/css/experiment.css" th:href="@{/css/experiment.css}" rel="stylesheet" />
    <link href="../static/css/carousel.css" th:href="@{/css/carousel.css}" rel="stylesheet" />
    <link href="../static/css/test.css" th:href="@{/css/test.css}" rel="stylesheet" />
    <style>
        .demo-avd{position:fixed;width:200px;border-radius:.3em;overflow:hidden;-webkit-box-shadow:0 4px 20px rgba(0,0,0,.2);box-shadow:0 4px 20px rgba(0,0,0,.2);z-index:99;top:20px;right:20px;backdrop-filter:blur(10px)}.demo-avd--light{background-color:rgba(0,0,0,.8)}.demo-avd--dark{background-color:rgba(255,255,255,.8)}.demo-avd--light .demo-avd__template-text{color:#fff}.demo-avd--dark .demo-avd__template-img,.demo-avd--dark .demo-avd__template-text{color:rgba(0,0,0,.8)}.demo-avd .demo-avd__template-img{display:block;width:200px}.demo-avd .demo-avd__template-text{padding:10px;font-family:sans-serif!important}.demo-avd .demo-avd__template-text{font-size:14px;display:block;line-height:1.4;text-decoration:none}.demo-avd .demo-avd__template-text:hover{text-decoration:underline}.demo-avd .demo-avd__template-img img{display:block;width:200px}.demo-avd .demo-avd__template-text{text-decoration:none}.demo-avd__close{display:block;width:32px;height:32px;position:absolute;z-index:1;top:0;right:0;opacity:.8;cursor:auto}.demo-avd__close:hover{opacity:1}@media(max-width:800px){.demo-avd-cf{position:fixed;bottom:0!important;top:auto!important;left:0!important;right:0!important;width:100%!important;border-radius:0}.demo-avd-cf.demo-avd-cf--top-mb{top:0!important;bottom:auto!important}.demo-avd .demo-avd__template-img{display:none}.demo-avd .demo-avd__template-text{margin-top:2px}}
    </style>

    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">



    <style>
        .grid-container {
            display: grid;
            grid-gap: 10px;
            background-color: #2196F3;
            padding: 10px;
        }

        .grid-item {
            background-color: rgba(255, 255, 255, 0.8);
            text-align: center;
            padding: 20px;
            font-size: 30px;
        }

        .item1 {
            grid-column: 1 / span 2;
            grid-row: 1;
        }

        .item2 {
            grid-column: 3;
            grid-row: 1 / span 2;
        }

        .item5 {
            grid-column: 1 / span 3;
            grid-row: 3;
        }
    </style>
</head>

<body class="d-flex flex-column h-100">

<main role="main" class="flex-shrink-0">
    <header th:replace="fragments/general-restaurant :: header"></header>


    <section id="page-header">
        <div class="jumbotron jumbotron-fluid" th:style="'background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(' + ${restaurant.getImage()} + ');'">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6 col-width">
                        <h2 class="jumbotron-header">[[${restaurant.getRestaurantName()}]]</h2>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="slider owl-carousel">
        <div class="card1">
            <div class="img1">
                <img th:src="@{images/variva-carusel.jpg}" src ="../static/images/variva-carusel.jpg" alt="">
            </div>
        </div>
        <div class="card1">
            <div class="img1">
                <img th:src="@{images/variva-carusel.jpg}" src ="../static/images/variva-carusel.jpg" alt="">
            </div>
        </div>
        <div class="card1">
            <div class="img1">
                <img th:src="@{images/variva-carusel.jpg}" src ="../static/images/variva-carusel.jpg" alt="">
            </div>
        </div>
    </div>
    <script>
        $(".slider").owlCarousel({
            loop: true,
            autoplay: true,
            autoplayTimeout: 4000, //2000ms = 2s;
            autoplayHoverPause: true,
        });
    </script>


    <section id="about">

        <div class="container card-container">
            <div class="menu">

                <div class ="menu-group-heading">
                    <th:block th:each="category: ${categories}">
                        [[${category.getCategoryName()}]]
                    </th:block>
                    Pizze
                </div>
                <div class="menu-group">
                    <th:block th:each="foodItem: ${menu}">
                        <button class="menu-item">
                            <img class="menu-item-image" th:src="${foodItem.getImage()}" src ="${foodItem.getImage()}">
                            <div class="menu-item-text">
                                <h3 class="menu-item-heading">
                                    <span class="menu-item-name">[[${foodItem.getName()}]]</span>
                                    <span class="menu-item-price">[[${foodItem.getPrice()}]]KM</span>
                                </h3>
                            </div>
                        </button>
                        <div class="menu-item-content">
                            <div class="text-component text-center">
                                <p class="flex flex-wrap flex-center flex-gap-xxs">
                                    <a href="#0" class="cd-add-to-cart js-cd-add-to-cart" th:item-id="${foodItem.getId()}" th:item-image="${foodItem.getImage()}" th:item-name="${foodItem.getName()}" th:data-price="${foodItem.getPrice()}">Add To Cart</a>
                                </p>
                            </div>
                        </div>
                    </th:block>
                </div>
            </div>
        </div>
    </section>

    <div class="cd-cart cd-cart--empty js-cd-cart">
        <a href="#0" class="cd-cart__trigger text-replace">
            <ul class="cd-cart__count">
                <li>0</li>
                <li>0</li>
            </ul>
        </a>
        <div class="cd-cart__content">
            <div class="cd-cart__layout">
                <header class="cd-cart__header">
                    <h2>Cart</h2>
                    <span class="cd-cart__undo">Item removed. <a href="#0">Undo</a></span>
                </header>
                <div class="cd-cart__body">
                    <ul>

                    </ul>
                </div>
                <footer class="cd-cart__footer">
                    <a href="#0" class="cd-cart__checkout">
                        <em>Checkout - KM<span>0</span>
                            <svg class="icon icon--sm" viewBox="0 0 24 24"><g fill="none" stroke="currentColor"><line stroke-width="2" stroke-linecap="round" stroke-linejoin="round" x1="3" y1="12" x2="21" y2="12"></line><polyline stroke-width="2" stroke-linecap="round" stroke-linejoin="round" points="15,6 21,12 15,18 "></polyline></g>
                            </svg>
                        </em>
                    </a>
                </footer>
            </div>
        </div>
    </div>
</main>



<footer th:replace="fragments/general-restaurant :: footer">
</footer>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous">
</script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous">
</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous">
</script>
<script>
    const accordionBtns = document.querySelectorAll(".menu-item");

    accordionBtns.forEach((accordion) => {
        accordion.onclick = function () {
            this.classList.toggle("is-open");

            let content = this.nextElementSibling;
            console.log(content);

            if (content.style.maxHeight) {
                //this is if the accordion is open
                content.style.maxHeight = null;
            } else {
                //if the accordion is currently closed
                content.style.maxHeight = content.scrollHeight + "px";
                console.log(content.style.maxHeight);
            }
        };
    });
</script>

<script>
    // Utility function
    function Util () {};

    /*
        class manipulation functions
    */
    Util.hasClass = function(el, className) {
        if (el.classList) return el.classList.contains(className);
        else return !!el.className.match(new RegExp('(\\s|^)' + className + '(\\s|$)'));
    };

    Util.addClass = function(el, className) {
        var classList = className.split(' ');
        if (el.classList) el.classList.add(classList[0]);
        else if (!Util.hasClass(el, classList[0])) el.className += " " + classList[0];
        if (classList.length > 1) Util.addClass(el, classList.slice(1).join(' '));
    };

    Util.removeClass = function(el, className) {
        var classList = className.split(' ');
        if (el.classList) el.classList.remove(classList[0]);
        else if(Util.hasClass(el, classList[0])) {
            var reg = new RegExp('(\\s|^)' + classList[0] + '(\\s|$)');
            el.className=el.className.replace(reg, ' ');
        }
        if (classList.length > 1) Util.removeClass(el, classList.slice(1).join(' '));
    };

    Util.toggleClass = function(el, className, bool) {
        if(bool) Util.addClass(el, className);
        else Util.removeClass(el, className);
    };

    Util.setAttributes = function(el, attrs) {
        for(var key in attrs) {
            el.setAttribute(key, attrs[key]);
        }
    };

    /*
      DOM manipulation
    */
    Util.getChildrenByClassName = function(el, className) {
        var children = el.children,
            childrenByClass = [];
        for (var i = 0; i < el.children.length; i++) {
            if (Util.hasClass(el.children[i], className)) childrenByClass.push(el.children[i]);
        }
        return childrenByClass;
    };

    /*
        Animate height of an element
    */
    Util.setHeight = function(start, to, element, duration, cb) {
        var change = to - start,
            currentTime = null;

        var animateHeight = function(timestamp){
            if (!currentTime) currentTime = timestamp;
            var progress = timestamp - currentTime;
            var val = parseInt((progress/duration)*change + start);
            // console.log(val);
            element.setAttribute("style", "height:"+val+"px;");
            if(progress < duration) {
                window.requestAnimationFrame(animateHeight);
            } else {
                cb();
            }
        };

        //set the height of the element before starting animation -> fix bug on Safari
        element.setAttribute("style", "height:"+start+"px;");
        window.requestAnimationFrame(animateHeight);
    };

    /*
        Smooth Scroll
    */

    Util.scrollTo = function(final, duration, cb) {
        var start = window.scrollY || document.documentElement.scrollTop,
            currentTime = null;

        var animateScroll = function(timestamp){
            if (!currentTime) currentTime = timestamp;
            var progress = timestamp - currentTime;
            if(progress > duration) progress = duration;
            var val = Math.easeInOutQuad(progress, start, final-start, duration);
            window.scrollTo(0, val);
            if(progress < duration) {
                window.requestAnimationFrame(animateScroll);
            } else {
                cb && cb();
            }
        };

        window.requestAnimationFrame(animateScroll);
    };

    /*
      Focus utility classes
    */

    //Move focus to an element
    Util.moveFocus = function (element) {
        if( !element ) element = document.getElementsByTagName("body")[0];
        element.focus();
        if (document.activeElement !== element) {
            element.setAttribute('tabindex','-1');
            element.focus();
        }
    };

    /*
      Misc
    */

    Util.getIndexInArray = function(array, el) {
        return Array.prototype.indexOf.call(array, el);
    };

    Util.cssSupports = function(property, value) {
        if('CSS' in window) {
            return CSS.supports(property, value);
        } else {
            var jsProperty = property.replace(/-([a-z])/g, function (g) { return g[1].toUpperCase();});
            return jsProperty in document.body.style;
        }
    };

    /*
        Polyfills
    */
    //Closest() method
    if (!Element.prototype.matches) {
        Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;
    }

    if (!Element.prototype.closest) {
        Element.prototype.closest = function(s) {
            var el = this;
            if (!document.documentElement.contains(el)) return null;
            do {
                if (el.matches(s)) return el;
                el = el.parentElement || el.parentNode;
            } while (el !== null && el.nodeType === 1);
            return null;
        };
    }

    //Custom Event() constructor
    if ( typeof window.CustomEvent !== "function" ) {

        function CustomEvent ( event, params ) {
            params = params || { bubbles: false, cancelable: false, detail: undefined };
            var evt = document.createEvent( 'CustomEvent' );
            evt.initCustomEvent( event, params.bubbles, params.cancelable, params.detail );
            return evt;
        }

        CustomEvent.prototype = window.Event.prototype;

        window.CustomEvent = CustomEvent;
    }

    /*
        Animation curves
    */
    Math.easeInOutQuad = function (t, b, c, d) {
        t /= d/2;
        if (t < 1) return c/2*t*t + b;
        t--;
        return -c/2 * (t*(t-2) - 1) + b;
    };
</script>
<script type="text/javascript">
    (function(){
        var productIds = [];
        var currentProductLimitQantity = false;
        var globalCartCount=0;
        // Add to Cart Interaction - by CodyHouse.co
        var cart = document.getElementsByClassName('js-cd-cart');
        if(cart.length > 0) {
            var cartAddBtns = document.getElementsByClassName('js-cd-add-to-cart'),
                cartBody = cart[0].getElementsByClassName('cd-cart__body')[0],
                cartList = cartBody.getElementsByTagName('ul')[0],
                cartListItems = cartList.getElementsByClassName('cd-cart__product'),
                cartTotal = cart[0].getElementsByClassName('cd-cart__checkout')[0].getElementsByTagName('span')[0],
                cartCount = cart[0].getElementsByClassName('cd-cart__count')[0],
                cartCountItems = cartCount.getElementsByTagName('li'),
                cartUndo = cart[0].getElementsByClassName('cd-cart__undo')[0],
                //productId = 0, //this is a placeholder -> use your real product ids instead
                cartTimeoutId = false,
                animatingQuantity = false;
            initCartEvents();


            function initCartEvents() {
                // add products to cart
                for(var i = 0; i < cartAddBtns.length; i++) {(function(i){
                    cartAddBtns[i].addEventListener('click', addToCart);
                })(i);}

                // open/close cart
                cart[0].getElementsByClassName('cd-cart__trigger')[0].addEventListener('click', function(event){
                    event.preventDefault();
                    toggleCart();
                });

                cart[0].addEventListener('click', function(event) {
                    if(event.target == cart[0]) { // close cart when clicking on bg layer
                        toggleCart(true);
                    } else if (event.target.closest('.cd-cart__delete-item')) { // remove product from cart
                        event.preventDefault();
                        removeProduct(event.target.closest('.cd-cart__product'));
                    }
                });

                // update product quantity inside cart
                cart[0].addEventListener('change', function(event) {
                    if(event.target.tagName.toLowerCase() == 'select') quickUpdateCart();
                });

                //reinsert product deleted from the cart
                cartUndo.addEventListener('click', function(event) {
                    if(event.target.tagName.toLowerCase() == 'a') {
                        event.preventDefault();
                        if(cartTimeoutId) clearInterval(cartTimeoutId);
                        // reinsert deleted product
                        var deletedProduct = cartList.getElementsByClassName('cd-cart__product--deleted')[0];
                        Util.addClass(deletedProduct, 'cd-cart__product--undo');
                        deletedProduct.addEventListener('animationend', function cb(){
                            deletedProduct.removeEventListener('animationend', cb);
                            Util.removeClass(deletedProduct, 'cd-cart__product--deleted cd-cart__product--undo');
                            deletedProduct.removeAttribute('style');
                            quickUpdateCart();
                        });
                        Util.removeClass(cartUndo, 'cd-cart__undo--visible');
                    }
                });
            };

            function addToCart(event) {
                event.preventDefault();
                if(animatingQuantity) return;
                var cartIsEmpty = Util.hasClass(cart[0], 'cd-cart--empty');
                //update cart product list
                console.log(event.toString());
                addProduct(this.getAttribute('item-id'),this.getAttribute('item-image'), this.getAttribute('item-name'), this.getAttribute('data-price'));

                if(!currentProductLimitQantity){
                    //update number of items
                    updateCartCount(cartIsEmpty);
                    //update total price
                    updateCartTotal(this.getAttribute('data-price'), true);
                    Util.removeClass(cart[0], 'cd-cart--empty');
                }currentProductLimitQantity=false;
                //show cart

            };

            function toggleCart(bool) { // toggle cart visibility
                var cartIsOpen = ( typeof bool === 'undefined' ) ? Util.hasClass(cart[0], 'cd-cart--open') : bool;

                if( cartIsOpen ) {
                    Util.removeClass(cart[0], 'cd-cart--open');
                    //reset undo
                    if(cartTimeoutId) clearInterval(cartTimeoutId);
                    Util.removeClass(cartUndo, 'cd-cart__undo--visible');
                    removePreviousProduct(); // if a product was deleted, remove it definitively from the cart

                    setTimeout(function(){
                        cartBody.scrollTop = 0;
                        //check if cart empty to hide it
                        if( Number(cartCountItems[0].innerText) == 0) Util.addClass(cart[0], 'cd-cart--empty');
                    }, 500);
                } else {
                    Util.addClass(cart[0], 'cd-cart--open');
                }
            };

            function addProduct(productId,image,name,price) {
                // this is just a product placeholder
                // you should insert an item with the selected product info
                // replace productId, productName, price and url with your real product info
                // you should also check if the product was already in the cart -> if it is, just update the quantity
                if(productIds.includes(productId)){
                    //alert(document.getElementById("cd-product-"+productId).value);
                    var quantityTemp = document.getElementById("cd-product-"+productId);
                    if(quantityTemp.value == 9)currentProductLimitQantity=true;
                    quantityTemp.value  =  quantityTemp.value < 9  ? +quantityTemp.value + 1 : quantityTemp.value;

                }else{
                    productIds.push(productId);
                    var productAdded =
                        '<li item-id='+productId+' class="cd-cart__product"><div class="cd-cart__image"><a href="#0"><img th:src='+image+' src='+image+' alt="placeholder"></a></div><div class="cd-cart__details"><h3 class="truncate"><a href="#0">'+name+'</a></h3><span class="cd-cart__price">'+price+'</span><div class="cd-cart__actions"><a href="#0" class="cd-cart__delete-item">Delete</a><div class="cd-cart__quantity"><label for="cd-product-'+ productId +'">Qty</label><span class="cd-cart__select"><select class="reset" id="cd-product-'+ productId +'" name="quantity"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option></select><svg class="icon" viewBox="0 0 12 12"><polyline fill="none" stroke="currentColor" points="2,4 6,8 10,4 "/></svg></span></div></div></div></li>';
                    cartList.insertAdjacentHTML('beforeend', productAdded);
                    console.log("ProdIds : "+productIds);
                }


                // console.log("this is name" + name);
                // console.log("this is image" + image);
                // console.log("this is price" + price);

            };

            function removeProduct(product) {
                if(cartTimeoutId) clearInterval(cartTimeoutId);
                removePreviousProduct(); // prduct previously deleted -> definitively remove it from the cart

                var topPosition = product.offsetTop,
                    productQuantity = Number(product.getElementsByTagName('select')[0].value),
                    productTotPrice = Number((product.getElementsByClassName('cd-cart__price')[0].innerText).replace('$', '')) * productQuantity;

                product.style.top = topPosition+'px';
                Util.addClass(product, 'cd-cart__product--deleted');

                //update items count + total price
                updateCartTotal(productTotPrice, false);
                updateCartCount(true, -productQuantity);
                Util.addClass(cartUndo, 'cd-cart__undo--visible');

                //wait 8sec before completely remove the item
                cartTimeoutId = setTimeout(function(){
                    Util.removeClass(cartUndo, 'cd-cart__undo--visible');
                    removePreviousProduct();
                }, 8000);
            };

            function removePreviousProduct() { // definitively removed a product from the cart (undo not possible anymore)
                var deletedProduct = cartList.getElementsByClassName('cd-cart__product--deleted');
                if(deletedProduct.length > 0 ) {
                    productIds = productIds.filter(function(value){
                        return value != deletedProduct[0].getAttribute('item-id');
                    });
                    deletedProduct[0].remove();
                }
            };

            function updateCartCount(emptyCart, quantity) {

                if( typeof quantity === 'undefined' ) {
                    var actual = Number(cartCountItems[0].innerText) + 1;
                    var next = actual + 1;

                    if( emptyCart ) {
                        cartCountItems[0].innerText = actual;
                        cartCountItems[1].innerText = next;
                        animatingQuantity = false;
                    } else {
                        Util.addClass(cartCount, 'cd-cart__count--update');
                        cartCountItems[0].innerText = actual;
                        Util.removeClass(cartCount, 'cd-cart__count--update');
                        cartCountItems[1].innerText = next;
                        animatingQuantity = false;
                    }
                } else {
                    var actual = Number(cartCountItems[0].innerText) + quantity;
                    var next = actual + 1;
                    cartCountItems[0].innerText = actual;
                    cartCountItems[1].innerText = next;
                    animatingQuantity = false;
                }
            };

            function updateCartTotal(price, bool) {
                console.log("THIS IS UPDATECARTTOTAL " + price);
                cartTotal.innerText = bool ? (Number(cartTotal.innerText) + Number(price)).toFixed(2) : (Number(cartTotal.innerText) - Number(price)).toFixed(2);
            };

            function quickUpdateCart() {
                var quantity = 0;
                var price = 0;

                for(var i = 0; i < cartListItems.length; i++) {
                    if( !Util.hasClass(cartListItems[i], 'cd-cart__product--deleted') ) {
                        var singleQuantity = Number(cartListItems[i].getElementsByTagName('select')[0].value);
                        quantity = quantity + singleQuantity;
                        price = price + singleQuantity*Number((cartListItems[i].getElementsByClassName('cd-cart__price')[0].innerText).replace('$', ''));
                    }
                }

                cartTotal.innerText = price.toFixed(2);
                cartCountItems[0].innerText = quantity;
                cartCountItems[1].innerText = quantity+1;
            };
        }
    })();
</script>
</body>

</html>